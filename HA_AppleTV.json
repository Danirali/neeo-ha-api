{
  "name": "Home Assistant TV",
  "manufacturer": "Danirali",
  "type": "AVRECEIVER",
  "version": 2,
  "variables": {
    "HA_IP": "192.168.0.6", 
    "HA_Port": "8123",      
    "HA_Token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiI4MjAyM2MwYjUxMWQ0ZDE0YTY4MDljM2E4OTUyNjVmNCIsImlhdCI6MTc1Mzk1MjQ2NCwiZXhwIjoyMDY5MzEyNDY0fQ.BX6hhiVCFHvhVbzUAhhYz-HIdKNHq9BB13sHUzh1n3s", 
    "EntityId": "cinema_room",
    "Name": "Apple TV"
  },
  "discover": {
    "welcomeheadertext": "Home Assistant Apple TV Driver",
    "welcomedescription": "This driver controls selected Apple TVs via the Home Assistant Rest API.",
    "command": {
      "type": "static",
      "command": "",
      "queryresult": "$" 
    }
  },
  "template": {
    "name": "$Name",
    "dynamicname": "$Name", 
    "dynamicid": "$EntityId_ha_http", 
    "variables": {
      "HA_IP": "$HA_IP",
      "HA_Port": "$HA_Port",
      "HA_Token": "$HA_Token",
      "EntityId": "$EntityId",
      "SwitchedOn": false,
      "Volume": 0,
      "PlayerState": "unknown",
      "MediaCoverURI": "",
      "UP": "up",
      "DOWN": "down",
      "LEFT": "left",
      "RIGHT": "right",
      "ENTER": "select",
      "BACK": "menu",
      "MENU": "home"
    },
    "listeners": {
      "HAStatus": {
        "type": "http-get",
        "ishub": true, 
        "command": "http://$HA_IP:$HA_Port/api/states/media_player.$EntityId", 
        "headers": {
          "Authorization": "Bearer $HA_Token",
          "Content-Type": "application/json"
        },
        "pooltime": "60", 
        "queryresult": ["$.state", "$.attributes.entity_picture", "$.attributes.volume_level"], 
        "evalwrite": [
          {
            "variable": "SwitchedOn",
            "value": "DYNAMIK JSON.parse(\"$Result\")[0] === 'on' || JSON.parse(\"$Result\")[0] === 'playing' || JSON.parse(\"$Result\")[0] === 'paused'"
          },
          {
            "variable": "MediaCoverURI",
            "value": "DYNAMIK JSON.parse(\"$Result\")[1] === null ? '' : JSON.parse(\"$Result\")[1]"
          },
          {
            "variable": "Volume",
            "value": "DYNAMIK JSON.parse(\"$Result\")[2] === null ? 0 : JSON.parse(\"$Result\")[2] * 100"
          },
          {
            "variable": "PlayerState",
            "value": "DYNAMIK JSON.parse(\"$Result\")[0]"
          }
        ]
      }
    },
    "switches": {
      "POWER": {
        "label": "On",
        "listen": "SwitchedOn",
        "evaldo": [
          {"test": "DYNAMIK $Result", "then": "POWER ON", "or": "POWER OFF"}
        ]
      }
    },
    "sliders": {
      "VOLUME": {
        "label": "Volume",
        "unit": "%",
        "listen": "Volume",
        "evaldo": [
          {"test": true, "then": "__VOLUMECHANGE", "or": ""}
        ]
      }
    },
    "images":{
        "AlbumCover" : {"label":"", "size" : "large", "listen":"MediaCoverURI"},
        "AlbumThumb" : {"label":"", "size" : "small", "listen":"MediaCoverURI"}
    },
    "buttons": {
      "POWER ON": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/turn_on\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": [{"variable": "SwitchedOn", "value": true}]
      },
      "POWER OFF": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/turn_off\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": [{"variable": "SwitchedOn", "value": false}]
      },
      "VOLUME UP": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/volume_up\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": [] 
      },
      "VOLUME DOWN": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/volume_down\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "__VOLUMECHANGE": {
        "label": "",
        "type": "http-rest",
        "command": "DYNAMIK \"{\\\"verb\\\":\\\"post\\\",\\\"call\\\":\\\"http://$HA_IP:$HA_Port/api/services/media_player/volume_set\\\", \\\"headers\\\":{\\\"Authorization\\\":\\\"Bearer $HA_Token\\\", \\\"Content-Type\\\":\\\"application/json\\\"}, \\\"message\\\":{\\\"entity_id\\\":\\\"media_player.$EntityId\\\", \\\"volume_level\\\": \" + ($Volume / 100) + \"}}\"",
        "evalwrite": []
      },
      "PLAY": { 
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/media_play\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "PAUSE": { 
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/media_pause\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "PLAY TOGGLE": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/media_play_pause\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "STOP": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/media_stop\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "NEXT": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/media_next_track\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "PREVIOUS": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/media_player/media_previous_track\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"media_player.$EntityId\"}}",
        "evalwrite": []
      },
      "CURSOR UP": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$UP"
      },
      "CURSOR DOWN": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$DOWN"
      },
      "CURSOR LEFT": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$LEFT"
      },
      "CURSOR RIGHT": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$RIGHT"
      },
      "CURSOR ENTER": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$ENTER"
      },
      "CURSOR BACK": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$BACK"
      },
      "CURSOR MENU": {
        "label": "",
        "type": "http-rest",
        "command": "{\"verb\":\"post\",\"call\":\"http://$HA_IP:$HA_Port/api/services/remote/send_command\", \"headers\":{\"Authorization\":\"Bearer $HA_Token\", \"Content-Type\":\"application/json\"}, \"message\":{\"entity_id\":\"remote.$EntityId\",\"command\":\"$MENU"
      }
    }
  }
}
